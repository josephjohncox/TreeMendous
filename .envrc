### use a certain pyenv version
use_python() {
    if [ -n "$(which pyenv)" ]; then
        local pyversion=$1
        pyenv local ${pyversion}
    fi
}

layout_virtualenv() {
    local pyversion=$1
    local pvenv=$2
    if [ -n "$(which pyenv virtualenv)" ]; then
        pyenv virtualenv --force --quiet ${pyversion} ${pvenv}-${pyversion}
    fi
    pyenv local --unset
}

layout_activate() {
    if [ -n "$(which pyenv)" ]; then
        source $(pyenv root)/versions/$1/bin/activate
    fi
}

# Prefer uv-managed local project env at .venv
export UV_PROJECT_ENV=.venv
export PYTHONPATH=$PWD/python:$PYTHONPATH

# If you still want pyenv for base Python, select a version
use_python 3.12.7

# Create and activate local .venv via uv
if [ ! -d ".venv" ]; then
  uv venv --python 3.12
fi
source .venv/bin/activate

# Sync dependencies
uv sync --all-extras